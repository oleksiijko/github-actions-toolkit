name: Full GitHub Actions Toolkit Test

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  test-toolkit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      # ✅ AI PR Summarizer
      - name: Run AI PR Summarizer
        uses: ./ai-pr-summarizer
        with:
          repo: ${{ github.repository }}
          pr_number: 1
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}

      - name: Print GPT Summary
        run: cat summary.md

      - name: Upload PR Summary
        uses: actions/upload-artifact@v4
        with:
          name: pr-summary
          path: summary.md

      # ✅ ChatOps Command Test
      - name: Run ChatOps PR Bot
        uses: ./chatops-pr-bot
        with:
          payload_path: ./examples/payload.json

      # ✅ Code Formatter
      - name: Run Code Formatter
        uses: ./code-formatter
        with:
          example_input: prettier

      - name: Show formatted files
        run: git diff --stat || echo "No changes"

      # ✅ Auto Update Dependencies
      - name: Run Auto Update
        uses: ./auto-update-dependencies
        with:
          package_manager: npm
          commit_message: "chore: auto-update deps"
          branch: main
